<div class="margin-horizontal-05rem order-detail-title mt-1">
  <h1 class="page-title">
    {{ 'ORDERS' | translate }}
  </h1>

  <div class="order-breadcrumb">
    <ul>
      <li class="decoration-line">
        <a [routerLink]="ordersLink(order)">
          {{ tabTitle(order) }}
        </a>
      </li>

      <li>
        >
      </li>

      <li class="decoration-line">
        {{ 'ORDER' | translate}} {{ order?.number_of_requests }}
      </li>
    </ul>
  </div>
</div>

<mat-card class="order-detail">
  <mat-card-content class="p-2">
    <div fxLayout="row wrap" fxLayout.lt-sm="column">

      <div fxFlex="100" class="order-number">
        {{ 'ORDER' | translate}} {{ order?.number_of_requests }}
      </div>

      <div fxFlex="50" class="order-status">
        <p class="p-label pr-1">
          {{ 'STATUS' | translate }}:
        </p>

        <p class="p-text">
         {{ order?.order_status_code | uppercase | translate }}
        </p>
      </div>

      <div fxFlex="50" class="order-request-date text-right">
        {{ order?.requested_date_time_formatted }}
      </div>
    </div>

    <div fxLayout="row wrap" fxLayout.lt-sm="column" class="place-of-delivery-wrapper">
      <div fxFlex="100">
        <p class="p-label pr-1">
          {{ 'CLIENT' | translate }}:
        </p>

        <p class="p-text">
          {{order?.customer_full_name}}
        </p>
      </div>

      <div fxFlex="100">
        <p class="p-label pr-1">
          {{ 'PHONE_NUMBER' | translate }}:
        </p>

        <p class="p-text">
          {{ !!order?.customer_main_phone_number ? order?.customer_main_phone_number : 'N/A' }}
        </p>
      </div>

      <div fxFlex="100">
        <p class="p-label pr-1">
          {{ 'CLIENT_ADDRESS' | translate }}:
        </p>

        <p class="p-text">
          {{!!order?.customer_full_address ? order?.customer_full_address : 'N/A'}}
        </p>
      </div>
    </div>

    <ngx-datatable
      class="material ml-0 mr-0 mt-1"
      [rows]="orderItems"
      [columnMode]="'force'"
      [headerHeight]="50"
      [footerHeight]="50"
      [scrollbarH]="true"
      [limit]="1000"
      [rowHeight]="50"cl
    >
      <ngx-datatable-column name="{{'NUMBER_OF_REQUESTS' | translate}}" [flexGrow]="1" [sortable]="false">
        <ng-template let-row="row" ngx-datatable-cell-template>
          {{ order?.number_of_requests }}
        </ng-template>
      </ngx-datatable-column>

      <ngx-datatable-column name="{{'MEDICATION' | translate}}" [flexGrow]="1" [sortable]="false">
        <ng-template let-row="row" ngx-datatable-cell-template>
          {{ row?.medication_name }}
        </ng-template>
      </ngx-datatable-column>

      <ngx-datatable-column name="{{'AMOUNT' | translate}}" [flexGrow]="1" [sortable]="false">
        <ng-template let-row="row" ngx-datatable-cell-template>
          {{ row?.quantity }}
        </ng-template>
      </ngx-datatable-column>

      <ngx-datatable-column name="{{'UNIT_PRICE' | translate}}" [flexGrow]="1" [sortable]="false">
        <ng-template let-row="row" ngx-datatable-cell-template>
          {{ row?.price_formatted }}
        </ng-template>
      </ngx-datatable-column>

      <ngx-datatable-column name="{{'AGREED_SUBTOTAL' | translate}}" [flexGrow]="1" [sortable]="false">
        <ng-template let-row="row" ngx-datatable-cell-template>
          {{ row?.subtotal_formatted }}
        </ng-template>
      </ngx-datatable-column>

      <ngx-datatable-column name="{{'IVA' | translate}}" [flexGrow]="1" [sortable]="false">
        <ng-template let-row="row" ngx-datatable-cell-template>
          {{ row?.tax_formatted }}
        </ng-template>
      </ngx-datatable-column>

      <ngx-datatable-column name="{{'TOTAL' | translate}}" [flexGrow]="1" [sortable]="false">
        <ng-template let-row="row" ngx-datatable-cell-template>
          {{ row?.total_formatted }}
        </ng-template>
      </ngx-datatable-column>

    </ngx-datatable>

    <div class="subtotal-and-total text-right">
      <div class="order-subtotal">
        <div class="label">
          {{'AGREED_SUBTOTAL' | translate}}:
        </div>
        <div class="text">
          {{order?.subtotal_formatted}}
        </div>
      </div>
      <div class="order-tax">
        <div class="label">
          {{'IVA' | translate}}:
        </div>
        <div class="text">
          {{order?.tax_formatted}}
        </div>
      </div>
      <div class="order-total">
        <div class="label">
          {{'TOTAL' | translate}}:
        </div>
        <div class="text">
          {{order?.total_formatted}}
        </div>
      </div>
    </div>

    <div class="text-center mt-1" *ngIf="currentUser?.role == 'drugstore_location'">
      <button mat-raised-button mat-sm-button
      class="mr-1 btn-default btn-no-border-radius"
      *ngIf="order.order_status_code == 'in_process' || order.order_status_code == 'dispatched'"
      (click)="updateStatus('cancel')">
        {{ 'CANCEL_ORDER' | translate}}
      </button>

      <button mat-raised-button mat-sm-button
      class="mr-1 btn-default btn-no-border-radius"
      (click)="updateStatus('release')"
      *ngIf="order.order_status_code == 'in_process'">
        {{ 'RELEASE_ORDER' | translate}}
      </button>

      <button mat-raised-button mat-sm-button color="primary"
      class="mr-1 btn-primary btn-no-border-radius"
      (click)="updateStatus('dispatch')"
      *ngIf="order.order_status_code == 'in_process'">
        {{ 'MARK_AS_DISPATCHED' | translate}}
      </button>
    </div>

  </mat-card-content>
</mat-card>